---
# Установка и запуск smoke для панели

- name: Install Panel Smoke Script
  ansible.builtin.copy:
    dest: /usr/local/bin/smoke_panel.sh
    mode: "0755"
    content: >-
      {{ lookup('file', 'files/smoke_panel.sh')
         | to_nice_yaml
         | regex_replace('^---\n', '') }}
  tags: ["smoke", "panel"]

- name: Run Panel Smoke
  ansible.builtin.command:
    argv: ["/usr/local/bin/smoke_panel.sh"]
  register: smoke_tests_panel_out
  changed_when: false
  failed_when: smoke_tests_panel_out.rc != 0
  tags: ["smoke", "panel"]

- name: Show Panel Smoke Output
  ansible.builtin.debug:
    var: smoke_tests_panel_out.stdout_lines
  tags: ["smoke", "panel"]
